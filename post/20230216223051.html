<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>Github 使用 rsync 同步网站到个人服务器 | 奥国天空</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Github 使用 rsync 同步网站到个人服务器</h1><a id="logo" href="/.">奥国天空</a><p class="description">Matteo's Daily Life and Reflections</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Github 使用 rsync 同步网站到个人服务器</h1><div class="post-meta">2023-02-16<span> | </span><span class="category"><a href="/categories/%E2%91%A2IT%E4%B8%96%E7%95%8C/">③IT世界</a><a href="/categories/%E2%91%A2IT%E4%B8%96%E7%95%8C/Blog%E7%9B%B8%E5%85%B3/">Blog相关</a></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 852</span><span class="post-meta-item-text"> 字</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i><span class="post-count"> 3</span><span class="post-meta-item-text"> 分钟</span></span></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-rsync-%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-text">1. rsync 优缺点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E4%BC%98%E7%82%B9"><span class="toc-text">1.1 优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E7%BC%BA%E7%82%B9"><span class="toc-text">1.2 缺点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E4%B8%AA%E4%BA%BA%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E8%AE%BE%E7%BD%AE"><span class="toc-text">2. 个人服务器端设置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%AE%89%E8%A3%85-rsync"><span class="toc-text">2.1 安装 rsync</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E6%96%B0%E5%BB%BA-rsync-%E7%94%A8%E6%88%B7"><span class="toc-text">2.2 新建 rsync 用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E7%94%9F%E6%88%90-SSH-key"><span class="toc-text">2.3 生成 SSH key</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E6%8A%8A-SSH-public-Key-%E5%8A%A0%E5%85%A5%E4%B8%AA%E4%BA%BA%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">2.4 把 SSH public Key 加入个人服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-%E4%BF%AE%E6%94%B9-SSH-%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE"><span class="toc-text">2.5 修改 SSH 默认配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-github%E4%BB%93%E5%BA%93%E8%AE%BE%E7%BD%AE"><span class="toc-text">3. github仓库设置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E8%AE%BE%E7%BD%AEGit%E4%BB%93%E5%BA%93"><span class="toc-text">3.1. 设置Git仓库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E4%BF%AE%E6%94%B9%E8%87%AA%E5%8A%A8%E5%8C%96-Actions-%E8%84%9A%E6%9C%AC"><span class="toc-text">3.2 修改自动化 Actions 脚本</span></a></li></ol></li></ol></div></div><div class="post-content"><h2 id="1-rsync-优缺点">1. rsync 优缺点</h2>
<h3 id="1-1-优点">1.1 优点</h3>
<ol>
<li>增量备份</li>
<li>可以镜像保存整个目录树和文件系统。</li>
<li>可以很容易做到保持原来文件的权限、时间、软硬连接等。</li>
<li>拥有优化的流程和比较高的文件传输效率。</li>
</ol>
<h3 id="1-2-缺点">1.2 缺点</h3>
<ol>
<li>
<p>大量小文件的时候,比对时间较长,有时候,同步过程中,rsync进程可能会停止或者僵死,如果小文件非常多就直接使用压缩包进行传输即可.</p>
</li>
<li>
<p>同步大文件的时候会出现中断的,未完成同步前是隐藏文件,可以通过续传(–partail)等参数进行实现续传.</p>
</li>
</ol>
<h2 id="2-个人服务器端设置">2. 个人服务器端设置</h2>
<h3 id="2-1-安装-rsync">2.1 安装 rsync</h3>
<p>要使用 rsync 同步，第一步当然是要安装 rsync 了，键入以下命令来完成 rsync 的安装：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install rsync</span><br></pre></td></tr></table></figure>
<p>安装成功会显示git的版本号</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync --version</span><br></pre></td></tr></table></figure>
<p>显示</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync  version 3.2.3  protocol version 31</span><br></pre></td></tr></table></figure>
<h3 id="2-2-新建-rsync-用户">2.2 新建 rsync 用户</h3>
<p>出于安全的原因考虑，我们肯定是不会使用root来运行同步功能，因此，我们需要创建一个 rsync 用户来执行同步。</p>
<p>键入以下命令来完成同步用户的创建：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo adduser rsyncer</span><br></pre></td></tr></table></figure>
<p>创建用户的途中会要求输入用户密码，这个密码请务必记住，切换到这个用户时需要，其它配置使用默认值直接回车就行。</p>
<h3 id="2-3-生成-SSH-key">2.3 生成 SSH key</h3>
<p>有很多方法生成 SSH key：</p>
<ol>
<li>
<p>在服务器运行 ssh-keygen</p>
</li>
<li>
<p>在git客户端生成，如 SourceTree 、Gitkranken 中都可以生成</p>
</li>
</ol>
<p>生成一个 Key 对，其中一个扩展名是.pub，是公匙。假设分别命名为：id_rsa 和 id_rsa.pub</p>
<h3 id="2-4-把-SSH-public-Key-加入个人服务器">2.4 把 SSH public Key 加入个人服务器</h3>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">su rsyncer  <span class="params">#</span> 要输入密码</span><br><span class="line">cd ~</span><br><span class="line">mkdir www   <span class="params">#</span> 创建同步目录</span><br><span class="line">mkdir .ssh</span><br><span class="line">chmod 700 .ssh</span><br><span class="line">touch .ssh/authorized<span class="built_in">_</span>keys</span><br><span class="line">chmod 600 .ssh/authorized<span class="built_in">_</span>keys</span><br></pre></td></tr></table></figure>
<p>注意：<strong>.ssh的权限必须是700，authorized_keys的权限必须是600</strong></p>
<h3 id="2-5-修改-SSH-默认配置">2.5 修改 SSH 默认配置</h3>
<p>以下内容<strong>一般不用修改</strong>，如果同步有问题再来修改。</p>
<p>vim /etc/ssh/sshd_config<br>
打开一下三项配置前的注释，若没有则在最后添加</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RSAAuthentication yes</span><br><span class="line">PubkeyAuthentication yes     </span><br><span class="line">AuthorizedKeysFile  .ssh/authorized<span class="built_in">_</span>keys</span><br></pre></td></tr></table></figure>
<p>修改保存后重启sshd服务</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart sshd.service</span><br></pre></td></tr></table></figure>
<h2 id="3-github仓库设置">3. github仓库设置</h2>
<h3 id="3-1-设置Git仓库">3.1. 设置Git仓库</h3>
<p>打开仓库设置，按下图把相关设置加入 secrets，</p>
<p><img src="https://raw.githubusercontent.com/lthcweb/BlogImg/main/gp/202302162317704.webp" alt="Github仓库设置"></p>
<p>其中“私匙”是上面生成的钥匙对中没有扩展名的那个文件，用文本编辑器打开复制。</p>
<h3 id="3-2-修改自动化-Actions-脚本">3.2 修改自动化 Actions 脚本</h3>
<p>把以下内容加入脚本：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- name: webfactory/ssh-agent</span><br><span class="line">  uses: webfactory/ssh-agent@v0.7.0</span><br><span class="line">  with:</span><br><span class="line">    ssh-private-key: <span class="built_in">$</span>&#123;&#123; secrets.HONGKONG<span class="built_in">_</span>PRIVATE<span class="built_in">_</span>KEY &#125;&#125;</span><br><span class="line"></span><br><span class="line">- name: Publish hexo to remote host</span><br><span class="line">  <span class="params">#</span> `rsync`命令实现增量同步, --delete参数表示会删除远程文件夹中本地不存在的文件</span><br><span class="line">  <span class="params">#</span> -a是复合参数, 可复制本地文件的全部属性至远程, -v会显示具体同步的文件信息</span><br><span class="line">  <span class="params">#</span> 如果首次运行可添加-n参数, 即-anv, 可显示同步的文件信息但不实际操作</span><br><span class="line">  <span class="params">#</span> exclude中的文件夹路径是相对于本地同步文件夹而言, 即&quot;.deploy<span class="built_in">_</span>git/.git&quot;</span><br><span class="line">  run: |</span><br><span class="line">    rsync -av -e &quot;ssh -o StrictHostKeyChecking=no&quot; --delete --exclude=&#123;&#x27;.git/&#x27;,&#x27;.github/&#x27;&#125; public/ <span class="built_in">$</span>&#123;&#123; secrets.HONGKONG<span class="built_in">_</span>USERNAME &#125;&#125;@<span class="built_in">$</span>&#123;&#123; secrets.HONGKONG<span class="built_in">_</span>SERVER<span class="built_in">_</span>IP &#125;&#125;:<span class="built_in">$</span>&#123;&#123; secrets.HONGKONG<span class="built_in">_</span>WWW<span class="built_in">_</span>PATH &#125;&#125;</span><br></pre></td></tr></table></figure>
<p><strong>特别注意：</strong><code>ssh -o StrictHostKeyChecking=no</code> 不能少，否则连不上个人服务器。</p>
</div><div class="tags"><a href="/tags/Blog"><i class="fa fa-tag">Blog</i></a><a href="/tags/安装"><i class="fa fa-tag">安装</i></a></div><div class="post-nav"><a class="next" href="/post/20230214141418.html">情人节的起源和风行世界的原因</a></div><div id="remark42"></div><script>var remark_config = {
  host: 'https://remark.matteo.eu.org',
  site_id: 'matteo',
  locale: 'zh',
  simple_view: false,
  no_footer: true
}
</script><script>!function(e,n){for(var o=0;o<e.length;o++){var r=n.createElement("script"),c=".js",d=n.head||n.body;"noModule"in r?(r.type="module",c=".mjs"):r.async=!0,r.defer=!0,r.src=remark_config.host+"/web/"+e[o]+c,d.appendChild(r)}}(remark_config.components||["embed"],document);</script></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E2%91%A1%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">②编程语言</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E2%91%A1%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/C/">C++</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E2%91%A2IT%E4%B8%96%E7%95%8C/">③IT世界</a><span class="category-list-count">12</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E2%91%A2IT%E4%B8%96%E7%95%8C/Blog%E7%9B%B8%E5%85%B3/">Blog相关</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E2%91%A2IT%E4%B8%96%E7%95%8C/Markdown/">Markdown</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E2%91%A2IT%E4%B8%96%E7%95%8C/%E5%89%8D%E6%B2%BF%E6%8A%80%E6%9C%AF/">前沿技术</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E2%91%A2IT%E4%B8%96%E7%95%8C/%E5%A5%87%E5%B7%A7%E7%BB%8F%E9%AA%8C/">奇巧经验</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E2%91%A3%E5%BE%B7%E8%AF%AD%E5%AD%A6%E4%B9%A0/">④德语学习</a><span class="category-list-count">4</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E2%91%A3%E5%BE%B7%E8%AF%AD%E5%AD%A6%E4%B9%A0/%E5%8F%91%E9%9F%B3/">发音</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E2%91%A3%E5%BE%B7%E8%AF%AD%E5%AD%A6%E4%B9%A0/%E8%AF%AD%E6%B3%95/">语法</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E2%91%A4%E4%BA%BA%E7%94%9F%E7%99%BE%E5%91%B3/">⑤人生百味</a><span class="category-list-count">6</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E2%91%A4%E4%BA%BA%E7%94%9F%E7%99%BE%E5%91%B3/%E8%83%A1%E8%A8%80%E4%B9%B1%E8%AF%AD/">胡言乱语</a><span class="category-list-count">6</span></li></ul></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/c/" style="font-size: 15px;">c++</a> <a href="/tags/Blog/" style="font-size: 15px;">Blog</a> <a href="/tags/%E5%AE%89%E8%A3%85/" style="font-size: 15px;">安装</a> <a href="/tags/Markdown/" style="font-size: 15px;">Markdown</a> <a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" style="font-size: 15px;">人工智能</a> <a href="/tags/%E5%9F%9F%E5%90%8D/" style="font-size: 15px;">域名</a> <a href="/tags/email/" style="font-size: 15px;">email</a> <a href="/tags/%E4%BB%A3%E8%AF%8D/" style="font-size: 15px;">代词</a> <a href="/tags/%E5%86%A0%E8%AF%8D/" style="font-size: 15px;">冠词</a> <a href="/tags/%E5%8A%A8%E8%AF%8D/" style="font-size: 15px;">动词</a> <a href="/tags/%E5%90%8D%E8%AF%8D/" style="font-size: 15px;">名词</a> <a href="/tags/%E7%83%AD%E7%82%B9/" style="font-size: 15px;">热点</a> <a href="/tags/%E7%A7%91%E5%AD%A6/" style="font-size: 15px;">科学</a> <a href="/tags/%E7%BE%8E%E9%A3%9F/" style="font-size: 15px;">美食</a> <a href="/tags/%E8%AF%BB%E5%90%8E%E6%84%9F/" style="font-size: 15px;">读后感</a> <a href="/tags/%E8%8A%82%E6%97%A5/" style="font-size: 15px;">节日</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/post/20230216223051.html">Github 使用 rsync 同步网站到个人服务器</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20230214141418.html">情人节的起源和风行世界的原因</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20230213231310.html">一个直径60米的气球在18000米高空需要多少氦气？</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20230213140541.html">ChatGPT, MJ Prompt Tool 和 Midjourney协同创作插画</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20230212225128.html">为什么东方神话里都是仙女嫁给穷人，而西方神话都是灰姑娘嫁王子？</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20230212155422.html">中国食物在国际上的地位</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20230212115653.html">Hexo中如何控制首页\归档页\标签页的文章数量</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20230211235610.html">读史书有感</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20230211215635.html">说同意的时候，并不都代表同意</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20230208190737.html">基于域名创建无限数量的电子邮件email</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2023 <a href="/." rel="nofollow">奥国天空.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js"></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0"></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/css/search.css?v=1.0.0"><script type="text/javascript" src="/js/search.js?v=1.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
  search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="复制成功！"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>